#!/bin/sh

# Git ì €ì¥ì†Œ ë£¨íŠ¸ë¡œ ì´ë™
cd "$(git rev-parse --show-toplevel)" || exit 1

# Frontend ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd frontend || exit 1

# TypeScript íƒ€ì… ì²´í¬ (ì „ì²´ í”„ë¡œì íŠ¸)
echo "ğŸ” Running TypeScript type check..."
npm run typecheck || {
  echo "âŒ Type check failed. Please fix type errors before committing."
  exit 1
}

# ESLint (ë³€ê²½ëœ íŒŒì¼ë§Œ, staged íŒŒì¼ ì§ì ‘ ì²´í¬)
echo "ğŸ” Running ESLint on staged files..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' || true)

if [ -n "$STAGED_FILES" ]; then
  # frontend ë””ë ‰í† ë¦¬ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§
  FRONTEND_FILES=$(echo "$STAGED_FILES" | grep "^frontend/" | sed 's|^frontend/||' || true)

  if [ -n "$FRONTEND_FILES" ]; then
    echo "Checking: $FRONTEND_FILES"
    echo "$FRONTEND_FILES" | xargs npx eslint --fix || {
      echo "âŒ ESLint failed. Please fix linting errors before committing."
      exit 1
    }

    # eslintê°€ íŒŒì¼ì„ ìˆ˜ì •í–ˆìœ¼ë©´ ë‹¤ì‹œ stagedì— ì¶”ê°€
    echo "$FRONTEND_FILES" | xargs git add
  fi
fi

echo "âœ… All checks passed!"
